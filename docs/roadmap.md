# Pet 桌面宠物系统开发 Roadmap

基于[产品文档](product.md)和[架构文档](architecture.md)制定。

---

## Phase 1: 基础框架 ✅

**目标**: 搭建项目基础架构和多进程通信机制

- [x] 1.1 项目初始化 - 创建 Cargo workspace，配置 `Cargo.toml`
- [x] 1.2 创建 crate 结构 - 创建 `app`, `common`, `tray`, `theater`, `manager` 五个 crate
- [x] 1.3 共享库 `common` - 实现数据模型、配置读写、存储服务
- [x] 1.4 配置存储系统 - 使用 toml crate 实现配置文件读写
- [x] 1.5 主进程框架 - 实现进程管理器，支持启动/停止/监控子进程
- [x] 1.6 进程间通信 - 实现基于配置文件的进程间状态同步机制
- [x] 1.7 系统托盘进程 - 使用 `tray-icon` 实现托盘图标和菜单

---

## Phase 2: 剧场进程（Bevy）

**目标**: 实现宠物 3D 渲染和基础交互

- [ ] 2.1 Bevy App 配置 - 创建 Bevy 应用基础框架，配置必要插件
- [ ] 2.2 透明无边框窗口 - 配置 `WindowPlugin` 实现透明无边框悬浮窗
- [ ] 2.3 置顶显示 - 实现窗口 `AlwaysOnTop` 功能
- [ ] 2.4 GLB 模型加载 - 实现 GLB/glTF 格式 3D 模型加载与渲染
- [ ] 2.5 摄像机设置 - 配置适合桌面宠物显示的摄像机参数
- [ ] 2.6 光照设置 - 配置合适的光照效果
- [ ] 2.7 窗口拖拽 - 实现鼠标拖拽移动窗口功能
- [ ] 2.8 点击交互 - 实现点击宠物触发事件

---

## Phase 3: Replay 系统

**目标**: 实现行为脚本驱动的宠物动作回放系统

- [ ] 3.1 脚本数据结构 - 定义 `BehaviorScript`, `Keyframe`, `Action` 数据结构
- [ ] 3.2 脚本加载器 - 实现 RON 格式行为脚本的加载与解析
- [ ] 3.3 Replay 插件 - 创建 Bevy Replay 插件，管理脚本回放状态
- [ ] 3.4 关键帧系统 - 实现按时间轴执行关键帧动作的系统
- [ ] 3.5 动画播放 - 实现 `PlayAnimation` 动作，播放模型内置动画
- [ ] 3.6 移动动作 - 实现 `MoveTo` 动作，控制宠物位置移动
- [ ] 3.7 缩放动作 - 实现 `Scale` 动作，控制宠物缩放
- [ ] 3.8 随机选择 - 实现 `Random` 动作，随机选择下一个脚本
- [ ] 3.9 脚本切换 - 实现脚本结束后自动切换到 `next` 脚本
- [ ] 3.10 内置脚本 - 创建 `idle`, `walk`, `happy`, `sleep` 内置脚本
- [ ] 3.11 交互触发 - 实现交互事件（点击）触发脚本切换

---

## Phase 4: 宠物管理器（Iced）

**目标**: 实现宠物创建和管理的 GUI 界面

- [ ] 4.1 Iced App 框架 - 创建 Iced Application 基础框架
- [ ] 4.2 视图路由 - 实现创建/列表/设置三个视图的切换
- [ ] 4.3 创建宠物界面 - 实现描述输入和生成按钮的 UI
- [ ] 4.4 Meshy AI 集成 - 实现 Meshy AI API 调用（创建任务、轮询状态、下载模型）
- [ ] 4.5 生成进度显示 - 显示模型生成进度（Pending/InProgress/Succeeded）
- [ ] 4.6 宠物列表界面 - 显示已创建的宠物列表，支持预览
- [ ] 4.7 切换宠物 - 实现选择宠物并应用到剧场的功能
- [ ] 4.8 删除宠物 - 实现删除宠物及其模型文件
- [ ] 4.9 设置界面 - 实现 API Key 配置和保存
- [ ] 4.10 开机自启设置 - 实现开机自启选项的 UI 和逻辑

---

## Phase 5: 完善优化

**目标**: 提升稳定性和用户体验

- [ ] 5.1 开机自启功能 - 实现各平台的开机自启注册
- [ ] 5.2 首次运行引导 - 首次启动自动打开管理器引导创建宠物
- [ ] 5.3 错误处理 - 完善各模块的错误处理和用户提示
- [ ] 5.4 日志系统 - 实现日志记录，便于调试
- [ ] 5.5 性能优化 - 优化 Bevy 渲染性能，降低资源占用
- [ ] 5.6 macOS 适配 - 测试并适配 macOS 平台
- [ ] 5.7 Windows 适配 - 测试并适配 Windows 平台
- [ ] 5.8 Linux 适配 - 测试并适配 Linux 平台（X11/Wayland）
- [ ] 5.9 窗口位置记忆 - 保存并恢复宠物窗口位置
- [ ] 5.10 优雅退出 - 实现应用退出时的清理工作

---

## 里程碑

| 里程碑 | 完成标准 |
|--------|---------|
| **M1: 最小可运行** | 完成 Phase 1 + Phase 2，能显示静态 3D 宠物 |
| **M2: 行为系统** | 完成 Phase 3，宠物能自动执行行为脚本 |
| **M3: 完整功能** | 完成 Phase 4，能通过 AI 创建和管理宠物 |
| **M4: 发布就绪** | 完成 Phase 5，跨平台稳定运行 |

---

## 技术栈

| 领域 | 技术方案 |
|------|---------|
| 宠物剧场 | Bevy 0.18 |
| 管理界面 | Iced 0.14 |
| 系统托盘 | tray-icon 0.21 |
| AI 集成 | Meshy AI |
| 配置存储 | config crate |
| 模型格式 | GLB/glTF |
